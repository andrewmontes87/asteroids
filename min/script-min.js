var globals={bulletSpeed:2,canvasHeight:500,canvasWidth:900,canvasBgcolor:"#ddd",angleToVector:function(t){return{x:Math.cos(t*(Math.PI/180)),y:Math.sin(t*(Math.PI/180))}},dist:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},newGame:function(t){for(;t.entities.all().length;)t.entities.destroy(t.entities.all()[0]);globals.score=0,document.getElementById("score").innerHTML=globals.score,t.entities.create(Player,{center:{x:20,y:globals.canvasHeight/2}}),t.entities.create(AsteroidGenerator,{})}},Game=function(){this.c=new Coquette(this,"canvas",globals.canvasWidth,globals.canvasHeight,globals.canvasBgcolor),globals.newGame(this.c)},Player=function(t,e){this.name="Player",this.c=t.c;for(var i in e)this[i]=e[i];this.size={x:20,y:10},this.vel={x:0,y:0},this.color="blue",this.angle=0,this.mousePos={},this.gun={firing:!1,age:0,shoot:function(e){var i=globals.angleToVector(e.angle),s={x:e.center.x+15*i.x,y:e.center.y+15*i.y},n={x:6*i.x,y:6*i.y};t.c.entities.all(Bullet).length<40&&t.c.entities.create(Bullet,{size:{x:3,y:3},angle:e.angle,center:s,vel:n,type:"Player",color:"red"})}},this.update=function(){if(this.c.inputter.isDown(this.c.inputter.LEFT_MOUSE)&&this.center!==this.mousePos){this.mousePos=this.c.inputter.getMousePosition();var t=(this.mousePos.y-this.center.y)/(this.mousePos.x-this.center.x),e=Math.atan(t)*(180/Math.PI),i=0;i=globals.angleToVector(this.mousePos.x<=this.center.x?e+180:e),this.vel.x=5*i.x,this.vel.y=5*i.y,this.center.x+=this.vel.x,this.center.y+=this.vel.y,this.center.y>5&&(this.center.y-=5),this.center.y<globals.canvasHeight&&(this.center.y+=5),this.center.x>5&&(this.center.x-=5),this.center.x<globals.canvasWidth&&(this.center.x+=5),console.log()}this.c.inputter.isDown(this.c.inputter.UP_ARROW)&&this.center.y>5&&(this.center.y-=5),this.c.inputter.isDown(this.c.inputter.DOWN_ARROW)&&this.center.y<globals.canvasHeight&&(this.center.y+=5),this.c.inputter.isDown(this.c.inputter.LEFT_ARROW)&&this.center.x>5&&(this.center.x-=5),this.c.inputter.isDown(this.c.inputter.RIGHT_ARROW)&&this.center.x<globals.canvasWidth&&(this.center.x+=5),this.gun.firing?(this.gun.age++,this.c.inputter.isDown(this.c.inputter.SPACE)||this.c.inputter.isDown(this.c.inputter.LEFT_MOUSE)?this.gun.age%10||this.gun.shoot(this):(this.gun.firing=!1,this.gun.age=0)):(this.c.inputter.isDown(this.c.inputter.SPACE)||this.c.inputter.isDown(this.c.inputter.LEFT_MOUSE))&&(this.gun.firing=!0,this.gun.age=0,this.gun.shoot(this))},this.collision=function(t){("Asteroid"===t.name||"Bullet"===t.name&&"Enemy"===t.type)&&(this.c.entities.destroy(this),globals.newGame(this.c))},this.draw=function(t){t.fillStyle=this.color,t.fillRect(this.center.x-this.size.x/2,this.center.y-this.size.y/2,this.size.x,this.size.y)}},AsteroidGenerator=function(t,e){this.name="AsteroidGenerator",this.c=t.c;for(var i in e)this[i]=e[i];this.age=0,this.update=function(){this.age++,this.age%100||(this.asteroidCenter={x:globals.canvasWidth-20,y:globals.canvasHeight*Math.random()},this.asteroidVel={x:-1,y:0},this.asteroidAngle=180,this.c.entities.create(Asteroid,{center:this.asteroidCenter,vel:this.asteroidVel,angle:this.asteroidAngle,health:300,size:{x:20,y:20},color:"magenta"}))}},Asteroid=function(t,e){this.name="Asteroid",this.c=t.c;for(var i in e)this[i]=e[i];var s=Math.random();this.angle_vel=Math.random(),this.angle_vel=s>.5?this.angle_vel:-this.angle_vel,this.gun={age:0,shoot:function(e){var i=globals.angleToVector(e.angle),s={x:e.center.x+15*i.x,y:e.center.y+15*i.y},n={x:6*i.x,y:6*i.y};t.c.entities.all(Bullet).length<40&&t.c.entities.create(Bullet,{size:{x:3,y:3},angle:e.angle,center:s,vel:n,type:"Enemy",color:"black"})}},this.update=function(){this.center.x-=2,this.angle+=this.angle_vel,this.center.x<=0&&(globals.score-=100,document.getElementById("score").innerHTML=globals.score,this.c.entities.destroy(this)),this.health<=0&&(globals.score+=90,document.getElementById("score").innerHTML=globals.score,this.c.entities.destroy(this)),this.gun.age++,this.gun.age%20||this.gun.shoot(this)},this.draw=function(t){t.fillStyle=e.color,t.fillRect(this.center.x-this.size.x/2,this.center.y-this.size.y/2,this.size.x,this.size.y)}},Bullet=function(t,e){this.name="Bullet",this.c=t.c;for(var i in e)this[i]=e[i];this.lifespan=e.lifespan,this.age=0,this.update=function(){this.age++,this.center.x+=this.vel.x,this.center.y+=this.vel.y,(this.center.x>=globals.canvasWidth||this.center.x<=0||this.center.y>=globals.canvasHeight||this.center.y<=0)&&this.c.entities.destroy(this)},this.collision=function(t){"Asteroid"===t.name&&"Enemy"!==this.type?(t.health-=100,globals.score+=10,document.getElementById("score").innerHTML=globals.score,this.c.entities.destroy(this)):"Player"===t.name&&"Enemy"===this.type&&(this.c.entities.destroy(this),this.c.entities.destroy(t))},this.draw=function(t){t.fillStyle=this.color,t.fillRect(this.center.x-this.size.x/2,this.center.y-this.size.y/2,this.size.x,this.size.y)}};window.addEventListener("load",function(){new Game});